{% extends 'base.html' %}


{% block body %}
{% for movie in movies %}

<div class="col-sm-6 col-md-4 mb-3" style="">
  <div class="border mx-2 p-3">
      <img src="https://image.tmdb.org/t/p/w780/{{movie.poster_path}}" class="card-img-top p-1" width = "auto" height="400px">
      <div class="card-body">
        <h5 class="card_text">{{movie.title}} </h5>
        <h4>{{movie.popularity}}</h4>
        <hr>
        <div class ="col-5  offset-7">평점 : {{ movie.vote_average }}</div>
        <p class="card-text text-truncate"  >{{movie.overview}}</p>
        <hr>
        {% if request.user in movie.like_users.all %}
        <div class="card_text" data-like="true" style="color:crimson; height: 16px;" data-id="{{movie.id}}"> ♥</div>
        <span id = "like-count-{{movie.id}}" >{{ movie.like_users.count }}</span>
        {% else %}
        <div class="card_text" data-like="ture"  style="color:black"  data-id="{{movie.id}}"> ♡ </div>
        <span id = "like-count-{{movie.id}}" >{{ movie.like_users.count }}</span>
        {% endif %}
      </div>
  </div>
</div>
<script>  
  const likeBtns = document.querySelectorAll('[data-like]')
  
  likeBtns.forEach((likeBtn)=>{
    likeBtn.addEventListener('click',function(event){
      const movieId = event.target.dataset.id
      const movieLikeCount = document.querySelector(`#like-count-${movieId}`)

      axios.get(`/movies/${movieId}/like/`)
      .then((response)=>{
        console.log(response.data)
        if (response.data.status){
          event.target.innerText = '♥'
          event.target.style.color = "crimson"
          movieLikeCount.innerHTML = response.data.like_count

        } else{
          event.target.innerText = '♡'
          event.target.style.color = "black"
          movieLikeCount.innerHTML = response.data.like_count
        }
      }
      )
    })
  })  
  </script>
{% endfor %}

{% endblock %}